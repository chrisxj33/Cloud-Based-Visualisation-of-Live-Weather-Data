# Cloud-Based Visualization of Live Weather Data

### Importance

Spatial distribution of data is pivotal for understanding geographical trends and patterns. Even more important is the scalability of the framework via the cloud.

### Objectives

- Create a geospatial grid-based model of Victoria using the H3 Python library.
- Store the data on a PostgreSQL database with the PostGIS extension.
- Collect and integrate weather data into the database using the Open-Meteo API and Python.
- Schedule the process of updating the database with new data every 24 hours.
- Publish the data on GeoServer for the maps access.
- Host the backend (database & scripts) on an a cloud VM using Azure.
- Develop an interactive map using Leaflet & JS for visualizing the weather data.
- Implement interactive features such as info pop-ups and layer resolution switching in the map interface.

### Summary

Summarizing the entire process, when a user clicks on the provided link, they are redirected to the web map. This map immediately issues a data request to the Azure Virtual Machine (VM) hosting GeoServer. Upon receiving this request, GeoServer retrieves live data from the database and returns it to the map as a Web Feature Service (WFS). Extracting the geometry and attribute information, the map builds the hexagonal grid system, complete with styling and functionality. Simultaneously, a scheduled Python script constantly updates the database in the background. The culmination of this process is a web map that offers live temperature data accessible 24/7, operating as a fully automated system and all hosted on the cloud.

### Framework

The project can be broadly conceptualized into several stages, beginning with data processing. The grid system data created is then loaded into a database, which houses three distinct layers. Subsequently, a Python script is deployed to fetch temperature data from an API and insert it into the database. Set to run every 24 hours, this Python script ensures the daily update of temperature data. GeoServer is configured to publish these layers, thereby establishing a conduit for communication between the database and the map. Importantly, all of these processes are hosted on an Azure Virtual Machine to guarantee continuous uptime. The Leaflet map, with JavaScript code, is responsible for issuing data requests to GeoServer and returning the data back to the user. Additionally, JavaScript is leveraged to enrich map functionality, such as facilitating the switching between layers. The entire front end is hosted on GitHub Pages where the JS, HTML, and CSS data are stored.

![image](https://github.com/chrisxj33/Cloud-Based-Visualisation-of-Live-Weather-Data/assets/53899548/02f7b144-4995-48e6-b9b8-ea9ebe5785a2)

[Database Project.pdf](https://github.com/chrisxj33/Cloud-Based-Visualisation-of-Live-Weather-Data/files/12209381/Database.Project.pdf)

### Data Creation and Database

The initial step involved creating three hexagonal grid systems for Victoria, which were intended to structure the temperature data. This was accomplished using the H3 Python library, a flexible tool developed by Uber that facilitates the creation of scalable
hexagonal grid systems. The grid cells generated by the H3 library can easily be upscaled or downscaled, making it a suitable
choice for this project. To produce a grid system for Victoria, a boundary file was used to define the border extent. Before using the file for conversion, it was deemed good practice to reduce the complexity of the shape boundary. This is an important consideration as processing the file within Python can result in significantly longer conversion times. Therefore, the layer was opened in QGIS, and the "simplify" tool was applied to reduce the geometry complexity.

The next step was to write a Python script that would convert a geo-boundary into a grid of H3 cells. The Python code uses multiple libraries to achieve this such as:

- GeoPandas for dataframe manipulation
- Shapely for standardised spatial object formats
- H3 to generate a column of geometries for each cell

The code was executed three times to produce the three different resolution layers. Detail on the resolution of each layer can be
viewed in the table below.

| Resolution | Area (km^2) |
|------------|------------|
| 4          | 896        |
| 5          | 127        |
| 6          | 18         |

Upon successful creation of each layer, the next step involved integrating these layers into a PostgreSQL database with the PostGIS extension. It is crucial to ensure that each H3 layer is projected in the WGS:84 format, which was accounted for during the
loading process. Once the database was operational, the next task was to incorporate temperature data into each cell. For this purpose, Open-Meteo was chosen as the weather data source, given its speedy API response and generous daily limit for free API calls. To facilitate this, an additional Python script was created. Providing a high-level overview, this script initiates a call to the API, processes and formats the retrieved data appropriately, and then executes an SQL command to incorporate the newly acquired data into the database.

### Setting up the Cloud Virtual Machine

The VM creation process was relatively simple in terms of setting up the Python workflow, database hosting and geoserver hosting. Some networking configuration was required such as setting up ports. The main challenge that arrose was the mixed content error being recieved when trying to load the map over GitHub Pages. Given that GitHub Pages enforces HTTPS for secure, encrypted traffic, a conflict arose due to GeoServer's reliance on HTTP for non-encrypted data transmission. This led to a "mixed content policy error" as the hosted map attempted to make HTTP requests to GeoServer, illustrating that HTTPS and HTTP traffic cannot be mixed. To resolve this issue, the outgoing data from the VM needed to be encrypted to accommodate HTTPS requests. Azure's "Front Door" service, which encrypts all outgoing traffic, proved to be the solution. However, this process was fairly complex for me personally, requiring the setup of ports, IP addresses, and security measures.

### Web-based GIS app

The web-based GIS app was built with the LeafLet library, chosen for its flexibility and simplicity. The map provides two key functionalities:

1. A “cycle layers” button to allow the user to cycle between the three different resolutions. This allows the user to visualise the
data at a resolution suitable for their requirements.
2. An information pop-up when clicking on an individual cell. This pop-up returns the precise temperature for that cell

A more nuanced feature includes client side rendering. Due to the live and direct communcation between the map and GeoServer, the WFS requests do not contain styling information. Therefor JS styles each cell accordingly. GeoServer could potentially be set up with styling information however this has not been sufficnetly investigated.

### Skills Gained from Project

Through the execution of this project, several key skills were developed across various domains:

**Geospatial Data Analysis and Manipulation:** Using geospatial libraries such as H3 and GeoPandas in Python to handle and manipulate geospatial data. Experience was also gained in using the QGIS software for geospatial data visualization and manipulation.

**Database Management:** Creating and managing a PostgreSQL database with the PostGIS extension. This involved creating and structuring the database, importing geospatial data into the database, and writing SQL queries to insert and update data.

**API Integration:** Interacting with APIs (in this case, the Open-Meteo API) to fetch data, process it, and integrate it into an existing system.

**Server Configuration:** Configuring and managing a GeoServer instance for the purpose of publishing geospatial data layers. This involved setting up and maintaining the server, as well as configuring the server to communicate with the database.

**Automation and Scheduling:** Automating the data retrieval and update process with a Python script, and scheduling it to run at regular intervals (every 24 hours).

**Cloud Computing and Services:** Setting up and managing a cloud-based Virtual Machine on Azure, and overcoming associated challenges such as dealing with mixed content errors. Experience was also gained in configuring Azure's "Front Door" service for secure data transmission.

**Web Development and GIS:** Web development (HTML, CSS, JavaScript) with a focus on building interactive geospatial applications. Experience was gained in using the Leaflet library for map creation, and implementing features such as layer switching and info pop-ups. A nuanced understanding was gained in client-side rendering for geospatial data.

**Problem Solving:** Pproblem-solving and troubleshooting. Challenges such as dealing with mixed content errors, setting up secure data transmission, and dealing with live and direct communication between the map and GeoServer were successfully overcome.

**Project Management:** Project management skills to effectively balance and coordinate various aspects, from data analysis to web development and server management.

### Results

![image](https://github.com/chrisxj33/TemperatureGrid-Victoria/assets/53899548/fc62b609-431a-46bd-add8-3842daece8df)
